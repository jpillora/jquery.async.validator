<div data-demo>
  <form id="extending">
    <input name="field1" value="abc" data-validate="test">
    <input name="field2" value="abc" data-validate="testExtended">
    <input class="submit" type="submit"/>
  </form>
</div>

<script data-demo type="text/javascript">if(window.initScripts) window.initScripts['extending'] = function(demoContainer) {
  $.asyncValidator.addRules({
    field: {
      test: {
        fn: function(r) {
          console.log("comparing: " + r.val())
          if(r.val() !== r.myVar)
            return "Must equal '"+ r.myVar +"'";
          return true;
        },
        myVar: "abc"
      },
      testExtended: {
        extend: "test",
        myVar: "def" //test.myVar overridden !
      }
    }
  });

  demoContainer.find("form").asyncValidator();
};</script>

<script data-test type="text/javascript">if(window.mocha) (function(){ //@ sourceURL=extending-tests.js
  describe("Extending validations ", function() {

    var elem = $('form#extending');
    //prevent default submission
    elem.on('submit', function(e) { e.preventDefault(); return false; });

    describe("On submission", function() {

      //invalid test
      it("should be invalid", function(done) {
        elem.on('validated', function(e,result) {
          expect(result).to.be.a('string');
          done();
          elem.off('validated');
        });
        elem.submit();
      });

      //valid test
      // it("should be valid", function(done) {
      //   elem.find('input[name=field2]').val('def');
      //   elem.on('validated', function(e,result) {
      //     expect(result).to.be.undefined;
      //     done();
      //     elem.off('validated');
      //   });
      //   elem.submit();
      // });

      after(function() {
        var cont = elem.parent();
        cont.next().remove();cont.remove();
      });

    });

  });
})();</script>